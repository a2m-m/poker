要件定義書

1. 目的

物理トランプでテキサス・ホールデムを遊ぶときに、進行管理とチップ台帳をアプリが代行し、
「次誰の番？」「今いくら入ってる？」「SB/BBどこ？」「サイドポットどうなってる？」の揉め・詰まりを無くす。

⸻

2. 想定ユーザー / 利用シーン
	•	家で数人（2〜10人）がテーブルを囲み、タブレット1台を共有してプレイ
	•	アプリを操作するのは基本「その番の人」 or 「進行役1人」
	•	物理：カード、チップ
アプリ：スタック（残高）・ポット・アクション履歴・番・ブラインド表示

⸻

3. 前提・制約
	•	GitHub Pagesでホスティング（静的サイト）
	•	オフラインでも動くのが望ましい（最低限：通信なしで進行できる）
	•	AIコーディング前提（= 仕様が明確であることを重視）
	•	ルールは テキサス・ホールデム / ノーリミット（v1固定）

⸻

4. スコープ

4.1 v1で「やる」
	•	プレイヤー登録（名前、初期スタック、席順）
	•	ブラインド（SB/BB）・ボタンの自動移動
	•	ハンド進行（プリフロップ→フロップ→ターン→リバー→ショーダウン）
	•	アクション入力（チェック/ベット/コール/レイズ/フォールド/オールイン）
	•	ポット・各プレイヤーの投入額・残スタックの自動計算
	•	サイドポット計算（オールイン対応）
	•	勝者確定後の配当反映（分配、端数ルール適用）
	•	取り消し（Undo）・訂正フロー（最低限：1手戻す）
	•	ログ（このハンドで誰が何をしたか）

4.2 v1で「やらない」（明確化）
	•	カード入力・役判定の自動化（人間が確認して勝者選択）
	•	複数テーブル、オンライン対戦、ユーザーアカウント
	•	チップの物理認識（カメラ等）
	•	高度な統計（VPIP等）やハンド履歴のクラウド共有

⸻

5. 提供価値（ユーザーが得るもの）
	•	次の番と選べる行動が常に明確
	•	今コールにいくら必要かが即表示
	•	オールイン時のサイドポット計算ミスが無い
	•	チップ残高がズレてもアプリ台帳を正として復旧できる

⸻

6. ルール要件（アプリが実装すべきルール）

v1はルールブックv1.0に準拠。特に以下を機械的に保証する：
	•	プリフロップの開始アクション：UTG（BB左）
	•	フロップ以降：ボタン左から最初のアクティブ
	•	最小ベット：BB以上
	•	最小レイズ：直前の上げ幅以上
	•	最小レイズ未満のオールインは再オープンしない
	•	フォールドした人はそのハンドでアクション権なし
	•	残り1人なら即終了（ショーダウン不要）
	•	ポット分配：同点は均等分配、端数はボタンに近い方（時計回り優先）

⸻

7. 機能要件

7.1 ゲームセットアップ
	•	プレイヤー追加/削除
	•	席順の並べ替え（時計回り）
	•	初期スタック設定（全員一括・個別）
	•	ブラインド設定（SB/BB）
	•	端数処理方式（v1は固定でも可：ボタン近い方）
	•	2人時（ヘッズアップ）ルールの自動適用

7.2 ハンド管理
	•	「新しいハンド開始」
	•	ボタン移動
	•	SB/BB徴収（自動で残高から減算、ポットへ加算）
	•	ストリートをプリフロップにセット
	•	アクティブ（参加中）状態の初期化
	•	ストリート進行
	•	アクションが一周し、全員の投入額が揃う（またはフォールド）で次へ
	•	フロップ/ターン/リバーへの遷移ボタン
	•	ハンド終了
	•	残り1人：即勝者確定
	•	リバー後：ショーダウン画面へ

7.3 アクション入力
	•	その番のプレイヤーに対して、状況に応じて選択肢を制限表示
	•	例：支払額0ならチェック可、支払額>0ならチェック不可
	•	金額入力（ベット/レイズ）
	•	最小額、最大額（オールイン）をUIでガード
	•	オールイン
	•	サイドポット生成・対象者管理
	•	入力確定後
	•	ポット、プレイヤー投入額、残スタック更新
	•	次の番を自動決定

7.4 ショーダウン / 分配
	•	勝者選択（複数人選択可＝同点分配）
	•	ポット（メイン＋サイド）を対象者のみに分配
	•	分配結果（誰がいくら獲得）を表示
	•	「次のハンドへ」

7.5 取り消し / 訂正
	•	直近のアクションを1手戻す（Undo）
	•	そのストリートのリセット（任意：v1ではUndo連打で代替でも可）
	•	ハンドを破棄してやり直し（ミスディール時の救済）

7.6 表示（常時見える情報）
	•	現在ハンド：ボタン位置、SB/BB位置、ストリート
	•	ポット合計（メイン/サイド内訳も見られる）
	•	各プレイヤー：名前、残スタック、投入額、状態（アクティブ/フォールド/オールイン）
	•	「〇〇さんの番です」
	•	コール必要額、最小レイズ額

⸻

8. 非機能要件

8.1 UI/UX
	•	タブレットを囲む想定で遠目でも読める（大きい文字、強いコントラスト）
	•	誤タップを減らす（確定前プレビュー、危険操作は確認ダイアログ）
	•	片手でも操作しやすい（ボタン大きめ）

8.2 技術・運用
	•	GitHub Pagesで動く（SPAでもOK、静的ホスティング前提）
	•	ローカル保存（LocalStorage等）で
	•	途中中断→再開
	•	設定保持
	•	主要ブラウザ（iPad Safari / Android Chrome / PC Chrome）
	•	可能ならPWA化（オフライン起動・ホーム追加）

8.3 品質
	•	金額計算の正確性（最重要）
	•	例外（オールイン多発、同点、端数）で破綻しない

⸻

9. データ要件（保持すべき状態）

最低限必要なデータモデル：
	•	Game設定
	•	blinds: SB, BB
	•	players: [{id, name, seatIndex, stack, status}]
	•	dealerButtonIndex
	•	handNumber
	•	Hand状態
	•	street（preflop/flop/turn/river/showdown）
	•	potMain, sidePots[{amount, eligiblePlayerIds}]
	•	currentBet（そのストリートの最高投入額）
	•	lastRaiseSize（最小レイズ計算用）
	•	playerContribThisStreet[playerId]
	•	actionOrder（次の番計算用）
	•	actionLog（Undo用に差分/スナップショット）

⸻

10. 受け入れ条件（テスト観点）

最低限これを満たしたら「v1として成立」：
	1.	5人で開始でき、SB/BBが毎ハンド正しく回る
	2.	プリフロップの最初の番がUTGになっている
	3.	コール額・最小レイズ額が常に正しく表示され、UIが不正入力を防ぐ
	4.	オールイン→サイドポットが発生しても、対象者限定で分配できる
	5.	残り1人になったら即終了し、勝者にポットが付与される
	6.	Undoで直近1手を戻して整合性が壊れない
	7.	リロードしても途中状態が復元できる（少なくとも同一端末）

⸻
