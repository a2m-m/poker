③ デザイン要件定義書（操作と挙動の定義）

⸻

0. デザイン方針（UX原則）
   • 丁寧・事務的な文言で統一（口語/煽り/感嘆符なし）
   • **“いま何か / 誰の番か / いくら必要か / 何が可能か”**を常時表示
   • 不正操作は 押せない（灰色）＋理由を明示
   • 金額は事故防止のため 選択＋範囲制約（min/max/プリセット）を優先
   • 常に **Undo（1手戻す）**を提供し、復旧可能にする

⸻

1. 画面一覧（ページ構成）
   1. ホーム / ゲーム選択
   2. セットアップ（プレイヤー/ブラインド）
   3. テーブル（メイン進行画面）
   4. アクション入力（モーダル）
   5. ショーダウン（勝者選択）
   6. 配当結果（配当内訳→次ハンド）
   7. ログ/履歴（簡易）
   8. 設定（リセット等）

⸻

2. 画面別：UI要素と操作→挙動

2.1 ホーム / ゲーム選択

表示
• 新規ゲーム開始
• 前回を再開（保存データがある場合のみ）
• リセット（全削除）

操作→挙動
• 新規ゲーム開始：保存データがある場合は確認 → セットアップへ
• 前回を再開：最後の状態へ復帰（通常はテーブル）
• リセット：確認 → 全削除 → ホームに留まる

⸻

2.2 セットアップ（プレイヤー/ブラインド）

表示（必須）
• プレイヤー一覧（時計回りの席順）
• 名前 / 初期スタック / 削除
• プレイヤー追加
• ブラインド設定：SB / BB
• 開始（テーブルへ）

操作→挙動
• 追加：名前入力→確定で末尾に追加
• 席順変更：↑↓またはドラッグ→即反映
• スタック編集：数値→即反映
• 開始：2人未満は不可（理由表示）→初期化してテーブルへ

⸻

2.3 テーブル（メイン進行画面）※初心者配慮を中核に組み込み

2.3.1 レイアウト（推奨：横持ち）
A) 状態バー（最上部・常時表示）
• ハンド：#N
• ストリート：プリフロップ / フロップ / ターン / リバー / ショーダウン
• 目標：全員の投入額を揃えます
• 現在ベット：X
• コール必要額：Y（手番プレイヤー基準）
• 最小レイズ：Z（可能なときのみ／不可なら「—」）
• ボタン・SB・BBの位置（D/SB/BBバッジ）

B) ポット表示（中央）
• ポット合計：XXXX
• 内訳：メイン：… / サイド1：…（折りたたみ可）

C) プレイヤーカード（周囲 or リスト）
• 名前（大）
• 残スタック
• このストリート投入額
• 状態：参加中 / フォールド / オールイン
• 追加表示（重要）：必要 0 / 必要 200 など（色に依存しない）

D) 手番エリア（下部・最重要）
• 1行目：手番：〇〇
• 2行目：必要：コール Y（継続） / フォールド（終了）
• 3行目：可能：チェック / ベット / レイズ（最小 Z） / オールイン（最大 A）
※可能な項目のみ表示。不可なものは表示しない or 右端に「—」。

E) 操作ボタン（下部）
• アクション入力（モーダル起動）
• Undo（常設）
• ログ
• 設定

2.3.2 操作→挙動
• アクション入力 → 2.4モーダルへ
• Undo → 直近1アクションを巻き戻す（手番・ポット・投入額・ストリート遷移も含む）
• ログ → 2.7へ
• 設定 → 2.8へ

2.3.3 自動遷移（進行の自動化）
• アクション確定ごとに次手番へ
• ストリート終了条件を満たしたら次ストリートへ自動遷移
（遷移時にトースト：ストリートがフロップに進みました）
• リバー終了後に複数人残存 → ショーダウンへ
• 残り1人 → 即終了 → 配当結果へ

⸻

2.4 アクション入力（モーダル）※文言トーンを固定

表示
• タイトル：手番：〇〇
• 状況：現在ベット：X / コール必要額：Y / 最小レイズ：Z / 残スタック：A
• アクションボタン（状況で出し分け、文言統一）
• チェック
• コール Y
• ベット…
• レイズ…
• フォールド
• オールイン A

BET/RAISEの金額UI
• 大きい数値表示
• 最小 1/2ポット ポット 最大（=オールイン） のプリセット
• + - とテンキー（任意）
• 範囲表示：最小：min / 最大：A

押せない（無効）と理由表示（必須）
• ボタン灰色＋1行理由（例）
• チェック不可：コールが必要です（Y）
• ベット不可：既にベットがあります
• レイズ不可：最小レイズ未満のオールインにより再オープンしていません

確定→挙動
• 入力を検証（範囲外は確定不可）
• 確定で
• 残スタック/投入額/ポット更新
• サイドポット生成（必要時）
• 次手番へ
• モーダルを閉じてテーブルへ

⸻

2.5 ショーダウン（勝者選択）

表示
• ポット内訳：メイン＋サイド（各ポットにeligible一覧を表示）
• 勝者選択：ポット単位で選択（v1推奨・必須）
• eligible外は選択不可
• 複数選択＝同点分配
• 配当確定

操作→挙動
• 配当確定 → 端数処理を適用 → スタック更新 → 配当結果へ

⸻

2.6 配当結果

表示
• このハンド結果
• 勝者ごとの獲得額（メイン/サイド内訳）
• 更新後スタック一覧
• 次のハンドへ

操作→挙動
• 次のハンドへ → ボタン移動→SB/BB徴収→プリフロップ開始

⸻

2.7 ログ/履歴（簡易）

表示
• アクション時系列（例：UTG：コール 100 / BTN：レイズ 300）
• 戻る

操作→挙動
• 閲覧のみ（編集はUndoで）

⸻

2.8 設定

表示（v1最低限）
• 端数処理：ボタンに近い方へ
• バーン：やる/やらない（表示のみでも可）
• このハンドを破棄してやり直し
• ゲームリセット

操作→挙動
• 破棄：確認→現在ハンドを破棄→新ハンド開始
• リセット：確認→全削除→ホームへ

⸻

3. 状態遷移（ステートマシン）

3.1 画面状態
• HOME → SETUP → TABLE（IN_HAND）
• TABLE内で PREFLOP/FLOP/TURN/RIVER を内部状態として保持
• SHOWDOWN → PAYOUT → 次ハンドで TABLEへ戻る

3.2 プレイヤー状態
• 参加中（ACTIVE）
• フォールド（FOLDED）
• オールイン（ALL_IN）

⸻

4. UI出し分けルール（初心者が迷わないための固定ルール）
   • コール必要額 Y = max(0, currentBet - playerContribThisStreet[player])
   • 手番エリアは必ず以下を表示
   • 手番：〇〇
   • 必要：コール Y（継続） / フォールド（終了）
   • 可能：…（可能操作のみ列挙）
   • 各プレイヤーカードに 必要 n を表示（参加中のみ）
   • 無効操作は「押せない＋理由1行」を必須（モーダル内）
   • アクションボタン文言は「動詞＋金額」で統一
   • コール 200 / オールイン 3150 等

⸻

5. 例外・エラー時のデザイン
   • 不正金額：確定不可＋「最小/最大」を表示
   • 整合性エラー：復旧導線として
   • 直近ログの表示
   • Undoを強調
   • リロード復帰：復帰トースト表示（例：状態を復元しました）

⸻
